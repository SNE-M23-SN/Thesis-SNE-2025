<!DOCTYPE HTML>
<html lang="ru">
<head>
<!-- Generated by javadoc (21) on Fri Jun 06 16:44:09 SAMT 2025 -->
<title>CustomMetadataChatMemoryAdvisor</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="dc.created" content="2025-06-06">
<meta name="description" content="declaration: package: com.diploma.inno.component, class: CustomMetadataChatMemoryAdvisor">
<meta name="generator" content="javadoc/ClassWriterImpl">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../script-dir/jquery-ui.min.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
<script type="text/javascript" src="../../../../script-dir/jquery-3.6.1.min.js"></script>
<script type="text/javascript" src="../../../../script-dir/jquery-ui.min.js"></script>
</head>
<body class="class-declaration-page">
<script type="text/javascript">var pathtoroot = "../../../../";
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<div class="flex-box">
<header role="banner" class="flex-header">
<nav role="navigation">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="top-nav" id="navbar-top"><button id="navbar-toggle-button" aria-controls="navbar-top" aria-expanded="false" aria-label="Toggle navigation links"><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span><span class="nav-bar-toggle-icon">&nbsp;</span></button>
<div class="skip-nav"><a href="#skip-navbar-top" title="Skip navigation links">Skip navigation links</a></div>
<ul id="navbar-top-firstrow" class="nav-list" title="Navigation">
<li><a href="../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="nav-bar-cell1-rev">Class</li>
<li><a href="class-use/CustomMetadataChatMemoryAdvisor.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../../help-doc.html#class">Help</a></li>
</ul>
<ul class="sub-nav-list-small">
<li>
<p>Summary:</p>
<ul>
<li><a href="#nested-class-summary">Nested</a></li>
<li><a href="#field-summary">Field</a></li>
<li><a href="#constructor-summary">Constr</a></li>
<li><a href="#method-summary">Method</a></li>
</ul>
</li>
<li>
<p>Detail:</p>
<ul>
<li>Field</li>
<li><a href="#constructor-detail">Constr</a></li>
<li><a href="#method-detail">Method</a></li>
</ul>
</li>
</ul>
</div>
<div class="sub-nav">
<div id="navbar-sub-list">
<ul class="sub-nav-list">
<li>Summary:&nbsp;</li>
<li><a href="#nested-class-summary">Nested</a>&nbsp;|&nbsp;</li>
<li><a href="#field-summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor-summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-summary">Method</a></li>
</ul>
<ul class="sub-nav-list">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor-detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method-detail">Method</a></li>
</ul>
</div>
<div class="nav-list-search"><a href="../../../../search.html">SEARCH</a>
<input type="text" id="search-input" disabled placeholder="Search">
<input type="reset" id="reset-button" disabled value="reset">
</div>
</div>
<!-- ========= END OF TOP NAVBAR ========= -->
<span class="skip-nav" id="skip-navbar-top"></span></nav>
</header>
<div class="flex-content">
<main role="main">
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="sub-title"><span class="package-label-in-type">Package</span>&nbsp;<a href="package-summary.html">com.diploma.inno.component</a></div>
<h1 title="Class CustomMetadataChatMemoryAdvisor" class="title">Class CustomMetadataChatMemoryAdvisor</h1>
</div>
<div class="inheritance" title="Inheritance Tree"><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">java.lang.Object</a>
<div class="inheritance">org.springframework.ai.chat.client.advisor.AbstractChatMemoryAdvisor&lt;org.springframework.ai.chat.memory.ChatMemory&gt;
<div class="inheritance">com.diploma.inno.component.CustomMetadataChatMemoryAdvisor</div>
</div>
</div>
<section class="class-description" id="class-description">
<dl class="notes">
<dt>All Implemented Interfaces:</dt>
<dd><code>org.springframework.ai.chat.client.advisor.api.Advisor</code>, <code>org.springframework.ai.chat.client.advisor.api.CallAroundAdvisor</code>, <code>org.springframework.ai.chat.client.advisor.api.StreamAroundAdvisor</code>, <code>org.springframework.core.Ordered</code></dd>
</dl>
<hr>
<div class="type-signature"><span class="modifiers">public class </span><span class="element-name type-name-label">CustomMetadataChatMemoryAdvisor</span>
<span class="extends-implements">extends org.springframework.ai.chat.client.advisor.AbstractChatMemoryAdvisor&lt;org.springframework.ai.chat.memory.ChatMemory&gt;</span></div>
<div class="block">Custom Chat Memory Advisor for DevSecOps CI/CD Pipeline Anomaly Detection System.

 <p>This advisor extends Spring AI's <code>AbstractChatMemoryAdvisor</code> to provide specialized
 memory management for Jenkins build log analysis. It handles metadata enrichment, conversation
 context management, and build number tracking for AI-powered anomaly detection.</p>

 <h2 id="key-features-heading">Key Features</h2>
 <ul>
   <li><strong>Metadata Preservation:</strong> Maintains build numbers &amp; conversation context across AI interactions</li>
   <li><strong>Memory Windowing:</strong> Implements sliding window approach for conversation history management</li>
   <li><strong>JSON Cleaning:</strong> Automatically cleans AI responses from markdown formatting</li>
   <li><strong>Dual Mode Support:</strong> Handles both synchronous &amp; reactive (streaming) AI interactions</li>
   <li><strong>Build Tracking:</strong> Associates each message with specific Jenkins build numbers</li>
 </ul>

 <h2 id="architecture-integration-heading">Architecture Integration</h2>
 <p>This component integrates with the CI anomaly detection pipeline as follows:</p>
 <pre><code>
 Jenkins Logs → RabbitMQ → LogMessageListener → ChatClient (with this Advisor) → AI Analysis
                                                      ↓
                                              Database Storage (via SimpleDbChatMemory)
 </code></pre>

 <h2 id="usage-example-heading">Usage Example</h2>
 <pre><code>
 // Basic configuration
 ChatMemory chatMemory = new SimpleDbChatMemory(repository, 100);
 CustomMetadataChatMemoryAdvisor advisor = new CustomMetadataChatMemoryAdvisor(chatMemory);

 // Advanced configuration with builder
 CustomMetadataChatMemoryAdvisor advisor = CustomMetadataChatMemoryAdvisor
     .builder(chatMemory)
     .defaultConversationId("jenkins-job-name")
     .chatHistoryWindowSize(50)
     .order(1000)
     .build();

 // Integration with ChatClient
 ChatClient chatClient = ChatClient.builder()
     .defaultAdvisors(advisor)
     .build();
 </code></pre>

 <h2 id="memory-management-strategy-heading">Memory Management Strategy</h2>
 <p>The advisor implements a sophisticated memory management approach:</p>
 <ol>
   <li><strong>Pre-call:</strong> Fetches conversation history &amp; enriches with metadata</li>
   <li><strong>Windowing:</strong> Applies sliding window to prevent context overflow</li>
   <li><strong>Post-call:</strong> Stores AI responses with preserved metadata</li>
   <li><strong>Cleanup:</strong> Automatically cleans JSON responses from markdown artifacts</li>
 </ol>

 <h2 id="thread-safety-heading">Thread Safety</h2>
 <p>This class is thread-safe and can be used in concurrent environments. The underlying
 <code>ChatMemory</code> implementation handles concurrent access to conversation storage.</p></div>
<dl class="notes">
<dt>Since:</dt>
<dd>1.0</dd>
<dt>Version:</dt>
<dd>1.0</dd>
<dt>Author:</dt>
<dd>Khasan Abdurakhmanov</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list">
<li><code>AbstractChatMemoryAdvisor</code></li>
<li><code>ChatMemory</code></li>
<li><a href="SimpleDbChatMemory.html" title="class in com.diploma.inno.component"><code>SimpleDbChatMemory</code></a></li>
<li><a href="LogMessageListener.html" title="class in com.diploma.inno.component"><code>LogMessageListener</code></a></li>
</ul>
</dd>
</dl>
</section>
<section class="summary">
<ul class="summary-list">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<li>
<section class="nested-class-summary" id="nested-class-summary">
<h2>Nested Class Summary</h2>
<div class="caption"><span>Nested Classes</span></div>
<div class="summary-table three-column-summary">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Class</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color"><code>static class&nbsp;</code></div>
<div class="col-second even-row-color"><code><a href="CustomMetadataChatMemoryAdvisor.Builder.html" class="type-name-link" title="class in com.diploma.inno.component">CustomMetadataChatMemoryAdvisor.Builder</a></code></div>
<div class="col-last even-row-color">
<div class="block">Builder class for fluent configuration of <a href="CustomMetadataChatMemoryAdvisor.html" title="class in com.diploma.inno.component"><code>CustomMetadataChatMemoryAdvisor</code></a> instances.</div>
</div>
</div>
<div class="inherited-list">
<h2 id="nested-classes-inherited-from-class-org.springframework.ai.chat.client.advisor.AbstractChatMemoryAdvisor">Nested classes/interfaces inherited from class&nbsp;org.springframework.ai.chat.client.advisor.AbstractChatMemoryAdvisor</h2>
<code>org.springframework.ai.chat.client.advisor.AbstractChatMemoryAdvisor.AbstractBuilder&lt;T&gt;</code></div>
</section>
</li>
<!-- =========== FIELD SUMMARY =========== -->
<li>
<section class="field-summary" id="field-summary">
<h2>Field Summary</h2>
<div class="inherited-list">
<h3 id="fields-inherited-from-class-org.springframework.ai.chat.client.advisor.AbstractChatMemoryAdvisor">Fields inherited from class&nbsp;org.springframework.ai.chat.client.advisor.AbstractChatMemoryAdvisor</h3>
<code>CHAT_MEMORY_CONVERSATION_ID_KEY, CHAT_MEMORY_RETRIEVE_SIZE_KEY, chatMemoryStore, DEFAULT_CHAT_MEMORY_CONVERSATION_ID, DEFAULT_CHAT_MEMORY_RESPONSE_SIZE, defaultChatMemoryRetrieveSize, defaultConversationId</code></div>
<div class="inherited-list">
<h3 id="fields-inherited-from-class-org.springframework.ai.chat.client.advisor.api.Advisor">Fields inherited from interface&nbsp;org.springframework.ai.chat.client.advisor.api.Advisor</h3>
<code>DEFAULT_CHAT_MEMORY_PRECEDENCE_ORDER</code></div>
<div class="inherited-list">
<h3 id="fields-inherited-from-class-org.springframework.core.Ordered">Fields inherited from interface&nbsp;org.springframework.core.Ordered</h3>
<code>HIGHEST_PRECEDENCE, LOWEST_PRECEDENCE</code></div>
</section>
</li>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<li>
<section class="constructor-summary" id="constructor-summary">
<h2>Constructor Summary</h2>
<div class="caption"><span>Constructors</span></div>
<div class="summary-table two-column-summary">
<div class="table-header col-first">Constructor</div>
<div class="table-header col-last">Description</div>
<div class="col-constructor-name even-row-color"><code><a href="#%3Cinit%3E(org.springframework.ai.chat.memory.ChatMemory)" class="member-name-link">CustomMetadataChatMemoryAdvisor</a><wbr>(org.springframework.ai.chat.memory.ChatMemory&nbsp;chatMemory)</code></div>
<div class="col-last even-row-color">
<div class="block">Creates a new CustomMetadataChatMemoryAdvisor with default settings.</div>
</div>
<div class="col-constructor-name odd-row-color"><code><a href="#%3Cinit%3E(org.springframework.ai.chat.memory.ChatMemory,java.lang.String,int)" class="member-name-link">CustomMetadataChatMemoryAdvisor</a><wbr>(org.springframework.ai.chat.memory.ChatMemory&nbsp;chatMemory,
 <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;defaultConversationId,
 int&nbsp;chatHistoryWindowSize)</code></div>
<div class="col-last odd-row-color">
<div class="block">Creates a new CustomMetadataChatMemoryAdvisor with custom conversation and window settings.</div>
</div>
<div class="col-constructor-name even-row-color"><code><a href="#%3Cinit%3E(org.springframework.ai.chat.memory.ChatMemory,java.lang.String,int,int)" class="member-name-link">CustomMetadataChatMemoryAdvisor</a><wbr>(org.springframework.ai.chat.memory.ChatMemory&nbsp;chatMemory,
 <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;defaultConversationId,
 int&nbsp;chatHistoryWindowSize,
 int&nbsp;order)</code></div>
<div class="col-last even-row-color">
<div class="block">Creates a new CustomMetadataChatMemoryAdvisor with full configuration control.</div>
</div>
</div>
</section>
</li>
<!-- ========== METHOD SUMMARY =========== -->
<li>
<section class="method-summary" id="method-summary">
<h2>Method Summary</h2>
<div id="method-summary-table">
<div class="table-tabs" role="tablist" aria-orientation="horizontal"><button id="method-summary-table-tab0" role="tab" aria-selected="true" aria-controls="method-summary-table.tabpanel" tabindex="0" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table', 3)" class="active-table-tab">All Methods</button><button id="method-summary-table-tab1" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab1', 3)" class="table-tab">Static Methods</button><button id="method-summary-table-tab2" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab2', 3)" class="table-tab">Instance Methods</button><button id="method-summary-table-tab4" role="tab" aria-selected="false" aria-controls="method-summary-table.tabpanel" tabindex="-1" onkeydown="switchTab(event)" onclick="show('method-summary-table', 'method-summary-table-tab4', 3)" class="table-tab">Concrete Methods</button></div>
<div id="method-summary-table.tabpanel" role="tabpanel">
<div class="summary-table three-column-summary" aria-labelledby="method-summary-table-tab0">
<div class="table-header col-first">Modifier and Type</div>
<div class="table-header col-second">Method</div>
<div class="table-header col-last">Description</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>org.springframework.ai.chat.client.advisor.api.AdvisedResponse</code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#aroundCall(org.springframework.ai.chat.client.advisor.api.AdvisedRequest,org.springframework.ai.chat.client.advisor.api.CallAroundAdvisorChain)" class="member-name-link">aroundCall</a><wbr>(org.springframework.ai.chat.client.advisor.api.AdvisedRequest&nbsp;request,
 org.springframework.ai.chat.client.advisor.api.CallAroundAdvisorChain&nbsp;chain)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Provides synchronous (blocking) advice around AI chat interactions.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code>reactor.core.publisher.Flux<wbr>&lt;org.springframework.ai.chat.client.advisor.api.AdvisedResponse&gt;</code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4"><code><a href="#aroundStream(org.springframework.ai.chat.client.advisor.api.AdvisedRequest,org.springframework.ai.chat.client.advisor.api.StreamAroundAdvisorChain)" class="member-name-link">aroundStream</a><wbr>(org.springframework.ai.chat.client.advisor.api.AdvisedRequest&nbsp;request,
 org.springframework.ai.chat.client.advisor.api.StreamAroundAdvisorChain&nbsp;chain)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab2 method-summary-table-tab4">
<div class="block">Provides reactive (streaming) advice around AI chat interactions.</div>
</div>
<div class="col-first even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static <a href="CustomMetadataChatMemoryAdvisor.Builder.html" title="class in com.diploma.inno.component">CustomMetadataChatMemoryAdvisor.Builder</a></code></div>
<div class="col-second even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#builder(org.springframework.ai.chat.memory.ChatMemory)" class="member-name-link">builder</a><wbr>(org.springframework.ai.chat.memory.ChatMemory&nbsp;memory)</code></div>
<div class="col-last even-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">Creates a new Builder instance for fluent configuration of the advisor.</div>
</div>
<div class="col-first odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code>static <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></code></div>
<div class="col-second odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4"><code><a href="#cleanJsonString(java.lang.String)" class="member-name-link">cleanJsonString</a><wbr>(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;rawJson)</code></div>
<div class="col-last odd-row-color method-summary-table method-summary-table-tab1 method-summary-table-tab4">
<div class="block">Cleans AI-generated JSON responses by removing markdown artifacts and extracting pure JSON content.</div>
</div>
</div>
</div>
</div>
<div class="inherited-list">
<h3 id="methods-inherited-from-class-org.springframework.ai.chat.client.advisor.AbstractChatMemoryAdvisor">Methods inherited from class&nbsp;org.springframework.ai.chat.client.advisor.AbstractChatMemoryAdvisor</h3>
<code>doGetChatMemoryRetrieveSize, doGetConversationId, doNextWithProtectFromBlockingBefore, getChatMemoryStore, getName, getOrder</code></div>
<div class="inherited-list">
<h3 id="methods-inherited-from-class-java.lang.Object">Methods inherited from class&nbsp;java.lang.<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html" title="class or interface in java.lang" class="external-link">Object</a></h3>
<code><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#clone()" title="class or interface in java.lang" class="external-link">clone</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#equals(java.lang.Object)" title="class or interface in java.lang" class="external-link">equals</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#finalize()" title="class or interface in java.lang" class="external-link">finalize</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#getClass()" title="class or interface in java.lang" class="external-link">getClass</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#hashCode()" title="class or interface in java.lang" class="external-link">hashCode</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#notify()" title="class or interface in java.lang" class="external-link">notify</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#notifyAll()" title="class or interface in java.lang" class="external-link">notifyAll</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#toString()" title="class or interface in java.lang" class="external-link">toString</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#wait()" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#wait(long)" title="class or interface in java.lang" class="external-link">wait</a>, <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/Object.html#wait(long,int)" title="class or interface in java.lang" class="external-link">wait</a></code></div>
</section>
</li>
</ul>
</section>
<section class="details">
<ul class="details-list">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<li>
<section class="constructor-details" id="constructor-detail">
<h2>Constructor Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="&lt;init&gt;(org.springframework.ai.chat.memory.ChatMemory)">
<h3>CustomMetadataChatMemoryAdvisor</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="element-name">CustomMetadataChatMemoryAdvisor</span><wbr><span class="parameters">(org.springframework.ai.chat.memory.ChatMemory&nbsp;chatMemory)</span></div>
<div class="block">Creates a new CustomMetadataChatMemoryAdvisor with default settings.

 <p>This constructor initializes the advisor with:</p>
 <ul>
   <li>Default conversation ID handling</li>
   <li>Default chat history window size</li>
   <li>Default advisor order priority</li>
 </ul></div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>chatMemory</code> - the chat memory implementation to use for storing conversation history.
                   Must not be <code>null</code>. Typically a <a href="SimpleDbChatMemory.html" title="class in com.diploma.inno.component"><code>SimpleDbChatMemory</code></a> instance.</dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/NullPointerException.html" title="class or interface in java.lang" class="external-link">NullPointerException</a></code> - if chatMemory is <code>null</code></dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list">
<li><a href="SimpleDbChatMemory.html" title="class in com.diploma.inno.component"><code>SimpleDbChatMemory</code></a></li>
<li><code>AbstractChatMemoryAdvisor</code></li>
</ul>
</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="&lt;init&gt;(org.springframework.ai.chat.memory.ChatMemory,java.lang.String,int)">
<h3>CustomMetadataChatMemoryAdvisor</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="element-name">CustomMetadataChatMemoryAdvisor</span><wbr><span class="parameters">(org.springframework.ai.chat.memory.ChatMemory&nbsp;chatMemory,
 <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;defaultConversationId,
 int&nbsp;chatHistoryWindowSize)</span></div>
<div class="block">Creates a new CustomMetadataChatMemoryAdvisor with custom conversation and window settings.

 <p>This constructor allows fine-tuning of memory management behavior for specific
 Jenkins job monitoring scenarios. The advisor will automatically enable doStore
 and set a high priority order.</p>

 <h4 id="configuration-details--heading">Configuration Details:</h4>
 <ul>
   <li><strong>doStore:</strong> Always <code>true</code> - ensures all interactions are persisted</li>
   <li><strong>order:</strong> <code>Integer.MIN_VALUE + 1000</code> - high priority execution</li>
 </ul></div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>chatMemory</code> - the chat memory implementation for conversation storage</dd>
<dd><code>defaultConversationId</code> - the default conversation identifier, typically a Jenkins job name.
                             Used when no explicit conversation ID is provided in the request context.</dd>
<dd><code>chatHistoryWindowSize</code> - the maximum number of historical messages to retrieve and include
                             in the conversation context. Larger values provide more context but
                             may impact performance and token usage.</dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/NullPointerException.html" title="class or interface in java.lang" class="external-link">NullPointerException</a></code> - if chatMemory is <code>null</code></dd>
<dd><code><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/IllegalArgumentException.html" title="class or interface in java.lang" class="external-link">IllegalArgumentException</a></code> - if chatHistoryWindowSize is negative</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list-long">
<li><a href="#%3Cinit%3E(org.springframework.ai.chat.memory.ChatMemory,java.lang.String,int,int)"><code>CustomMetadataChatMemoryAdvisor(ChatMemory, String, int, int)</code></a></li>
</ul>
</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="&lt;init&gt;(org.springframework.ai.chat.memory.ChatMemory,java.lang.String,int,int)">
<h3>CustomMetadataChatMemoryAdvisor</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="element-name">CustomMetadataChatMemoryAdvisor</span><wbr><span class="parameters">(org.springframework.ai.chat.memory.ChatMemory&nbsp;chatMemory,
 <a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;defaultConversationId,
 int&nbsp;chatHistoryWindowSize,
 int&nbsp;order)</span></div>
<div class="block">Creates a new CustomMetadataChatMemoryAdvisor with full configuration control.

 <p>This constructor provides complete control over all advisor settings, allowing
 integration with complex advisor chains and custom execution ordering.</p>

 <h4 id="advisor-order-guidelines--heading">Advisor Order Guidelines:</h4>
 <ul>
   <li><strong>High Priority (negative values):</strong> Execute early in the chain</li>
   <li><strong>Default Priority (0):</strong> Standard execution order</li>
   <li><strong>Low Priority (positive values):</strong> Execute late in the chain</li>
 </ul></div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>chatMemory</code> - the chat memory implementation for conversation storage</dd>
<dd><code>defaultConversationId</code> - the default conversation identifier for requests without explicit IDs</dd>
<dd><code>chatHistoryWindowSize</code> - the maximum number of historical messages to include in context</dd>
<dd><code>order</code> - the execution order within the advisor chain. Lower values execute first.
              Recommended: negative values for memory advisors to ensure early execution.</dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/NullPointerException.html" title="class or interface in java.lang" class="external-link">NullPointerException</a></code> - if chatMemory is <code>null</code></dd>
<dd><code><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/IllegalArgumentException.html" title="class or interface in java.lang" class="external-link">IllegalArgumentException</a></code> - if chatHistoryWindowSize is negative</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list">
<li><code>Ordered</code></li>
<li><code>AbstractChatMemoryAdvisor</code></li>
</ul>
</dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
<!-- ============ METHOD DETAIL ========== -->
<li>
<section class="method-details" id="method-detail">
<h2>Method Details</h2>
<ul class="member-list">
<li>
<section class="detail" id="builder(org.springframework.ai.chat.memory.ChatMemory)">
<h3>builder</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type"><a href="CustomMetadataChatMemoryAdvisor.Builder.html" title="class in com.diploma.inno.component">CustomMetadataChatMemoryAdvisor.Builder</a></span>&nbsp;<span class="element-name">builder</span><wbr><span class="parameters">(org.springframework.ai.chat.memory.ChatMemory&nbsp;memory)</span></div>
<div class="block">Creates a new Builder instance for fluent configuration of the advisor.

 <p>The builder pattern provides a convenient way to configure complex advisor
 settings with method chaining and validation.</p>

 <h4 id="builder-usage-example--heading">Builder Usage Example:</h4>
 <pre><code>
 CustomMetadataChatMemoryAdvisor advisor = CustomMetadataChatMemoryAdvisor
     .builder(chatMemory)
     .defaultConversationId("jenkins-security-scan")
     .chatHistoryWindowSize(75)
     .order(-500)
     .build();
 </code></pre></div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>memory</code> - the chat memory implementation to use. Must not be <code>null</code>.</dd>
<dt>Returns:</dt>
<dd>a new Builder instance for fluent configuration</dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/NullPointerException.html" title="class or interface in java.lang" class="external-link">NullPointerException</a></code> - if memory is <code>null</code></dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list-long">
<li><a href="CustomMetadataChatMemoryAdvisor.Builder.html" title="class in com.diploma.inno.component"><code>CustomMetadataChatMemoryAdvisor.Builder</code></a></li>
</ul>
</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="aroundCall(org.springframework.ai.chat.client.advisor.api.AdvisedRequest,org.springframework.ai.chat.client.advisor.api.CallAroundAdvisorChain)">
<h3>aroundCall</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">org.springframework.ai.chat.client.advisor.api.AdvisedResponse</span>&nbsp;<span class="element-name">aroundCall</span><wbr><span class="parameters">(org.springframework.ai.chat.client.advisor.api.AdvisedRequest&nbsp;request,
 org.springframework.ai.chat.client.advisor.api.CallAroundAdvisorChain&nbsp;chain)</span></div>
<div class="block">Provides synchronous (blocking) advice around AI chat interactions.

 <p>This method implements the core advisor pattern for synchronous AI calls,
 handling the complete lifecycle of a chat interaction including:</p>

 <ol>
   <li><strong>Pre-processing:</strong> Enriches request with conversation history</li>
   <li><strong>Execution:</strong> Delegates to the next advisor in the chain</li>
   <li><strong>Post-processing:</strong> Stores AI response with metadata preservation</li>
 </ol>

 <h4 id="metadata-flow--heading">Metadata Flow:</h4>
 <p>The method ensures that critical metadata (especially <code>build_number</code>)
 flows correctly through the entire interaction lifecycle:</p>

 <pre><code>
 Request Context → Enriched Request → AI Response → Stored Response
      ↓                    ↓              ↓             ↓
 build_number=123 → build_number=123 → build_number=123 → build_number=123
 </code></pre>

 <h4 id="error-handling--heading">Error Handling:</h4>
 <p>This method is designed to be resilient to failures in the advisor chain.
 If an exception occurs during processing, the conversation state remains consistent.</p></div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>request</code> - the incoming chat request containing user message, context, and parameters.
                Must contain conversation ID and may contain build_number metadata.</dd>
<dd><code>chain</code> - the advisor chain for delegating to subsequent advisors and the final AI model.
              The chain handles the actual AI interaction and response generation.</dd>
<dt>Returns:</dt>
<dd>the AI response enriched with conversation context and metadata preservation.
         The response includes the AI-generated content and updated conversation state.</dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/RuntimeException.html" title="class or interface in java.lang" class="external-link">RuntimeException</a></code> - if the advisor chain fails or if critical metadata is corrupted</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list-long">
<li><code>before(AdvisedRequest)</code></li>
<li><code>observeAfter(AdvisedResponse)</code></li>
<li><code>CallAroundAdvisorChain.nextAroundCall(AdvisedRequest)</code></li>
</ul>
</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="aroundStream(org.springframework.ai.chat.client.advisor.api.AdvisedRequest,org.springframework.ai.chat.client.advisor.api.StreamAroundAdvisorChain)">
<h3>aroundStream</h3>
<div class="member-signature"><span class="modifiers">public</span>&nbsp;<span class="return-type">reactor.core.publisher.Flux&lt;org.springframework.ai.chat.client.advisor.api.AdvisedResponse&gt;</span>&nbsp;<span class="element-name">aroundStream</span><wbr><span class="parameters">(org.springframework.ai.chat.client.advisor.api.AdvisedRequest&nbsp;request,
 org.springframework.ai.chat.client.advisor.api.StreamAroundAdvisorChain&nbsp;chain)</span></div>
<div class="block">Provides reactive (streaming) advice around AI chat interactions.

 <p>This method implements the advisor pattern for streaming AI responses,
 handling real-time token streaming while maintaining conversation context
 and metadata consistency throughout the streaming process.</p>

 <h4 id="streaming-architecture--heading">Streaming Architecture:</h4>
 <p>The streaming implementation follows a reactive pattern:</p>
 <pre><code>
 Request → Pre-processing → Streaming AI → Message Aggregation → Post-processing
    ↓           ↓              ↓               ↓                    ↓
 Context → History Fetch → Token Stream → Complete Message → Memory Storage
 </code></pre>

 <h4 id="message-aggregation--heading">Message Aggregation:</h4>
 <p>The method uses <code>MessageAggregator</code> to collect streaming tokens
 into complete messages before storage. This ensures that:</p>
 <ul>
   <li>Partial responses are not stored in memory</li>
   <li>Complete conversation context is maintained</li>
   <li>Metadata is preserved across the entire streaming session</li>
 </ul>

 <h4 id="thread-safety--heading">Thread Safety:</h4>
 <p>This method is thread-safe and handles concurrent streaming sessions.
 Each stream maintains its own conversation context and metadata state.</p>

 <h4 id="error-handling--heading1">Error Handling:</h4>
 <p>The reactive stream includes error handling for:</p>
 <ul>
   <li>Network interruptions during streaming</li>
   <li>AI model failures or timeouts</li>
   <li>Memory storage failures</li>
 </ul></div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>request</code> - the incoming chat request for streaming interaction.
                Contains user message, conversation context, and streaming parameters.</dd>
<dd><code>chain</code> - the streaming advisor chain for delegating to subsequent advisors.
              Handles the actual streaming AI interaction and token generation.</dd>
<dt>Returns:</dt>
<dd>a reactive stream of <code>AdvisedResponse</code> objects representing
         the streaming AI response. Each response chunk contains partial content
         that is aggregated into complete messages for storage.</dd>
<dt>Throws:</dt>
<dd><code><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/RuntimeException.html" title="class or interface in java.lang" class="external-link">RuntimeException</a></code> - if the streaming chain fails or if critical errors occur during streaming</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list-long">
<li><code>before(AdvisedRequest)</code></li>
<li><code>observeAfter(AdvisedResponse)</code></li>
<li><code>MessageAggregator.aggregateAdvisedResponse(Flux, java.util.function.Consumer)</code></li>
<li><code>StreamAroundAdvisorChain</code></li>
</ul>
</dd>
</dl>
</section>
</li>
<li>
<section class="detail" id="cleanJsonString(java.lang.String)">
<h3>cleanJsonString</h3>
<div class="member-signature"><span class="modifiers">public static</span>&nbsp;<span class="return-type"><a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a></span>&nbsp;<span class="element-name">cleanJsonString</span><wbr><span class="parameters">(<a href="https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/String.html" title="class or interface in java.lang" class="external-link">String</a>&nbsp;rawJson)</span></div>
<div class="block">Cleans AI-generated JSON responses by removing markdown artifacts and extracting pure JSON content.

 <p>AI language models often wrap JSON responses in markdown code blocks for better readability.
 This utility method automatically detects and removes such formatting to ensure that only
 clean, parseable JSON is stored in the conversation memory.</p>

 <h4 id="cleaning-process--heading">Cleaning Process:</h4>
 <p>The method applies the following cleaning steps in sequence:</p>
 <ol>
   <li><strong>Null Check:</strong> Returns <code>null</code> for null input</li>
   <li><strong>Markdown Removal:</strong> Strips <code>```json</code> and <code>```</code> markers</li>
   <li><strong>Whitespace Trimming:</strong> Removes leading/trailing whitespace</li>
   <li><strong>JSON Extraction:</strong> Extracts content between first <code>{} and last {@code }</code></li>
 </ol>

 <h4 id="supported-input-formats--heading">Supported Input Formats:</h4>
 <p>The method handles various AI response formats:</p>
 <pre><code>
 // Markdown wrapped JSON
 ```json
 {"status": "success", "data": {...}}
 ```

 // Plain JSON with extra text
 Here's the analysis: {"status": "success"} - completed successfully

 // Clean JSON (unchanged)
 {"status": "success", "data": {...}}
 </code></pre>

 <h4 id="error-handling--heading2">Error Handling:</h4>
 <p>The method is designed to be safe and non-destructive:</p>
 <ul>
   <li>Returns original content if JSON extraction fails</li>
   <li>Preserves content when no cleaning is needed</li>
   <li>Handles malformed or incomplete JSON gracefully</li>
 </ul>

 <h4 id="performance-characteristics--heading">Performance Characteristics:</h4>
 <ul>
   <li><strong>Time Complexity:</strong> O(n) where n is the input string length</li>
   <li><strong>Space Complexity:</strong> O(n) for string operations</li>
   <li><strong>Thread Safety:</strong> This static method is thread-safe</li>
 </ul></div>
<dl class="notes">
<dt>Parameters:</dt>
<dd><code>rawJson</code> - the raw AI response that may contain markdown formatting or extra text.
                Can be <code>null</code>, in which case <code>null</code> is returned.</dd>
<dt>Returns:</dt>
<dd>the cleaned JSON string with markdown artifacts removed, or <code>null</code> if input was <code>null</code>.
         If JSON extraction fails, returns the trimmed input string.</dd>
<dt>Since:</dt>
<dd>1.0</dd>
<dt>See Also:</dt>
<dd>
<ul class="tag-list">
<li><code>observeAfter(AdvisedResponse)</code></li>
<li><code>AbstractMessage.getText()</code></li>
</ul>
</dd>
</dl>
</section>
</li>
</ul>
</section>
</li>
</ul>
</section>
<!-- ========= END OF CLASS DATA ========= -->
</main>
</div>
</div>
</body>
</html>
